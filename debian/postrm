#!/bin/sh
set -e

if [ "$1" = "purge" ]; then
    # Remove log and runtime files
    rm -f /var/log/lsyncd/lsyncd.log
    rm -f /var/run/lsyncd.status

    # Remove configs and includes
    rm -f /etc/lsyncd/lsyncd.conf.lua
    rm -f /etc/lsyncd/includes/extra
    rm -f /etc/lsyncd/includes/system
    rm -f /etc/lsyncd/includes/user

    # Remove logrotate file
    rm -f /etc/logrotate.d/lsyncd-backup

    # Remove systemd override
    rm -f /etc/systemd/system/lsyncd.service.d/override.conf

    # Remove helper script
    rm -f /usr/bin/lsyncd-merge-includes

    # Cleanup empty dirs
    rmdir --ignore-fail-on-non-empty /etc/lsyncd/includes || true
    rmdir --ignore-fail-on-non-empty /etc/lsyncd || true
    rmdir --ignore-fail-on-non-empty /etc/systemd/system/lsyncd.service.d || true
    rmdir --ignore-fail-on-non-empty /var/log/lsyncd || true

    # Tell systemd to forget overrides
    if [ -x /bin/systemctl ] || [ -x /usr/bin/systemctl ]; then
        systemctl daemon-reload || true
    fi
fi

exit 0
